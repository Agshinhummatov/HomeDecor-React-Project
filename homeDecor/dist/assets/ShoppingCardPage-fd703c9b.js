import{r as n,_ as p,j as t,w as L,C as z,f as A,D as T,E as F,F as B,L as D,u as M}from"./index-71d35b4f.js";import{S as G}from"./index-5d3cc970.js";import{s as k}from"./productCount.module-ab264d3d.js";import{P as _}from"./index-558c7693.js";import{B as J}from"./index-d3e9549a.js";import{u as v}from"./useSetPageTitle-2544d0c9.js";import"./button.module-6fdb41d6.js";const O=({productCount:s,productId:e,updateProductCount:r,price:a})=>{const[m,i]=n.useState(s),u=n.useCallback(()=>{const o=m+1;r(e,o,a),p.success("Product count increased"),i(o)},[m,e,r,a]),C=n.useCallback(()=>{if(m>1){const o=m-1;r(e,o,a),p.success("Product count decreased"),i(o)}},[m,e,r,a]);return n.useEffect(()=>{i(s)},[s]),t.jsxs("div",{className:k.counter,children:[t.jsx("button",{className:`${k.counter__item} ${k.btn}`,onClick:u,children:"+"}),t.jsx("div",{className:k.counter__item,children:m}),t.jsx("button",{className:`${k.counter__item} ${k.btn}`,onClick:C,children:"-"})]})},Q="_item_dwats_1",U="_item__img_dwats_33",Y="_item__deleteBtn_dwats_49",Z="_item__title_dwats_59",H="_item__color_dwats_69",K="_item__left_dwats_81",V="_item__right_dwats_109",W="_item__price_dwats_125",h={item:Q,item__img:U,item__deleteBtn:Y,item__title:Z,item__color:H,item__left:K,item__right:V,item__price:W},I=({img:s,title:e,lang:r,titleAz:a,titleRu:m,count:i,price:u,colorName:C,onDelete:o,currency:j,productId:y,updateProductCount:S,id:w})=>t.jsxs("div",{className:h.item,children:[t.jsx("div",{onClick:o,className:h.item__deleteBtn,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:t.jsx("path",{d:"M16.8878 15.7376C16.9633 15.8131 17.0232 15.9027 17.064 16.0014C17.1049 16.1 17.1259 16.2057 17.1259 16.3125C17.1259 16.4192 17.1049 16.5249 17.064 16.6236C17.0232 16.7222 16.9633 16.8118 16.8878 16.8873C16.8123 16.9628 16.7227 17.0227 16.6241 17.0635C16.5254 17.1044 16.4197 17.1254 16.313 17.1254C16.2062 17.1254 16.1005 17.1044 16.0019 17.0635C15.9032 17.0227 15.8136 16.9628 15.7381 16.8873L9.00045 10.1486L2.2628 16.8873C2.11034 17.0398 1.90356 17.1254 1.68795 17.1254C1.47234 17.1254 1.26557 17.0398 1.11311 16.8873C0.96065 16.7349 0.875 16.5281 0.875 16.3125C0.875 16.0969 0.96065 15.8901 1.11311 15.7376L7.85178 8.99996L1.11311 2.26231C0.96065 2.10985 0.875 1.90307 0.875 1.68746C0.875 1.47186 0.96065 1.26508 1.11311 1.11262C1.26557 0.960162 1.47234 0.874512 1.68795 0.874512C1.90356 0.874512 2.11034 0.960162 2.2628 1.11262L9.00045 7.85129L15.7381 1.11262C15.8906 0.960162 16.0973 0.874512 16.313 0.874512C16.5286 0.874512 16.7353 0.960162 16.8878 1.11262C17.0403 1.26508 17.1259 1.47186 17.1259 1.68746C17.1259 1.90307 17.0403 2.10985 16.8878 2.26231L10.1491 8.99996L16.8878 15.7376Z",fill:"#2D2D2B"})})}),t.jsxs("div",{className:h.item__left,children:[t.jsx(L,{to:`/details/${w}/${e}`,className:h.item__img,children:t.jsx("img",{src:s,alt:"img"})}),t.jsx("p",{className:h.item__title,children:r==="Az"?a:r==="Ru"?m:e})]}),t.jsxs("div",{className:h.item__right,children:[t.jsx("div",{style:{background:`${C}`},className:h.item__color}),t.jsx("div",{className:h.item__count,children:t.jsx(O,{price:u,productId:y,productCount:i,updateProductCount:S})}),t.jsxs("h3",{className:h.item__price,children:[u*i,t.jsx("span",{className:h.item__currency,children:j})]})]})]});I.propTypes={img:_.string.isRequired,title:_.string.isRequired,count:_.number.isRequired,price:_.number.isRequired,colorName:_.string,onDelete:_.func.isRequired,currency:_.string.isRequired,productId:_.number.isRequired,updateProductCount:_.func.isRequired,id:_.number.isRequired};const X="_items_krho1_1",tt={items:X},et=({setTotalPriceForSummary:s,lang:e})=>{const{data:r,isLoading:a,refetch:m}=z(),{data:i}=A(),[u,C]=n.useState(JSON.parse(localStorage.getItem("user"))),{data:o}=T();n.useState(0);const[j,y]=n.useState(0),[S]=F(),{setBasketCount:w}=B();n.useEffect(()=>{s(j.toFixed(2))},[j]),n.useEffect(()=>{},[r]);const $=(c,x,f)=>{const l=parseFloat(f);fetch(`http://localhost:3000/basketProduct/${c}`).then(d=>{if(!d.ok)throw new Error("Failed to fetch product data");return d.json()}).then(d=>{const b=(x-d.count)*l;d.count=x,fetch(`http://localhost:3000/basketProduct/${c}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then(P=>{if(!P.ok)throw e==="Az"?p.error("Məhsul sayı serverdə yenilənmədi"):e==="Ru"?p.error("Количество товаров не обновлено на сервере"):p.error("Failed to update product count on the server"),new Error("Failed to update product count on the server");m(),y(E=>E+Number(b))}).catch(P=>{p.error(P.message)})}).catch(d=>{p.error(d.message)})},q=c=>{S(c),m(),w(r.length),e==="Az"?p.success("Məhsul səbətdən silindi"):e==="Ru"?p.success("Товар удален из корзины"):p.success("Product deleted from basket")},g=r==null?void 0:r.filter(c=>i==null?void 0:i.some(x=>c.productId===x.id&&c.userId===(u==null?void 0:u.id)));return n.useEffect(()=>{if(g&&i){const c=g.reduce((f,l)=>{const d=i.find(b=>b.id===l.productId);return f+d.price*l.count},0);y(c);const x=g.reduce((f,l)=>(i.find(d=>d.id===l.productId),f+l.count),0);w(x)}},[r,i]),a||!g?t.jsx(D,{}):t.jsx("div",{className:tt.items,children:g==null?void 0:g.map(c=>{const x=i.find(l=>l.id===c.productId&&c.userId===(u==null?void 0:u.id)),f=o==null?void 0:o.find(l=>l.id===c.colorId);return t.jsx(I,{lang:e,basketProductId:c.id,updateProductCount:$,...x,productId:c.id,count:c.count,colorName:f==null?void 0:f.title,onDelete:()=>{q(c.id)}},c.id)})})},st="_shopping_c9wqz_1",it="_backbtn_c9wqz_7",rt="_shopping__items_c9wqz_23",R={shopping:st,backbtn:it,shopping__items:rt},ct=({children:s,lang:e})=>t.jsxs("section",{className:R.shopping,children:[t.jsx("div",{className:R.shopping__items,children:s}),t.jsx(L,{className:R.backbtn,to:"/products",children:e==="Az"?"Məhsullara geri dön":e==="Ru"?"Вернуться к товарам":"Back to products"})]}),ot="_summary_r4jyi_1",nt="_summary__title_r4jyi_19",N={summary:ot,summary__title:nt,"summary__count--title":"_summary__count--title_r4jyi_25","summary__total--title":"_summary__total--title_r4jyi_27"},at=({totalPriceForSummary:s,lang:e})=>{const{basketCount:r}=B();return t.jsxs("div",{className:N.summary,children:[t.jsx("h2",{className:N.summary__title,children:e==="Az"?"Summativ":e==="Ru"?"Итог":"Summary"}),t.jsx("div",{className:N.summary__count,children:t.jsxs("p",{className:N["summary__count--title"],children:[e==="Az"?"Məhsul sayı":e==="Ru"?"Количество товаров":"item count",t.jsx("span",{children:r})]})}),t.jsx("div",{className:N.summary__total,children:t.jsxs("p",{className:N["summary__total--title"],children:[e==="Az"?"Ümumi məbləğ":e==="Ru"?"Общая сумма":"Total",t.jsxs("span",{children:[s,"$"]})]})}),t.jsx(J,{href:"/checkout",children:e==="Az"?"Ödənişə keçin":e==="Ru"?"Перейти к оплате":"Proceed to checkout"})]})},ft=()=>{const{lang:s}=M(),[e,r]=n.useState(0);n.useState(0);const{data:a,isLoading:m}=A(),{data:i,isLoading:u,refetch:C}=z(),o=JSON.parse(localStorage.getItem("user")),j=i==null?void 0:i.filter(y=>a==null?void 0:a.some(S=>y.userId===(o==null?void 0:o.id)&&y.productId===S.id));switch(n.useEffect(()=>{C()},[]),s){case"Az":v("Səbət");break;case"Ru":v("Корзина");break;default:v("Shopping cart")}return t.jsx("main",{children:t.jsxs("div",{className:"container",children:[t.jsx(G,{title:s==="Az"?"Səbət":s==="Ru"?"Корзина":"Shopping cart"}),(j==null?void 0:j.length)>0?t.jsxs(ct,{lang:s,children:[t.jsx(et,{lang:s,setTotalPriceForSummary:r}),t.jsx(at,{lang:s,totalPriceForSummary:e})]}):t.jsx("h2",{style:{textAlign:"center"},children:s==="Az"?"Səbətiniz boşdur":s==="Ru"?"Ваша корзина пуста":"Your basket is empty"})]})})};export{ft as default};
